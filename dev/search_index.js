var documenterSearchIndex = {"docs":
[{"location":"functions/#Index","page":"Index","title":"Index","text":"","category":"section"},{"location":"functions/","page":"Index","title":"Index","text":"CurrentModule = ClimateTools","category":"page"},{"location":"functions/","page":"Index","title":"Index","text":"Modules = [ClimateTools]\nPrivate = false\nOrder   = [:function, :type]","category":"page"},{"location":"functions/#Base.findmax-Tuple{ClimGrid}","page":"Index","title":"Base.findmax","text":"findmax(C::ClimGrid; skipnan::Bool=false)\n\nReturn the maximum element of ClimGrid C and its index. If there are multiple maximal elements, then the first one will be returned. If any data element is NaN, this element is returned. The result is in line with max. As climate data can often have NaN values (irregular polygons, missing weather data), the option to skip NaNs is provided as a keyword argument.\n\n\n\n\n\n","category":"method"},{"location":"functions/#Base.findmin-Tuple{ClimGrid}","page":"Index","title":"Base.findmin","text":"findmin(C::ClimGrid; skipnan::Bool=false)\n\nReturn the minimum element of ClimGrid C and its index. If there are multiple minimal elements, then the first one will be returned. If any data element is NaN, this element is returned. The result is in line with min. As climate data can often have NaN values (irregular polygons, missing weather data), the option to skip NaNs is provided as a keyword argument.\n\n\n\n\n\n","category":"method"},{"location":"functions/#Base.maximum-Tuple{ClimGrid}","page":"Index","title":"Base.maximum","text":"maximum(A::ClimGrid)\n\nCompute the maximum value of ClimGrid A\n\n\n\n\n\n","category":"method"},{"location":"functions/#Base.merge-Tuple{ClimGrid, ClimGrid}","page":"Index","title":"Base.merge","text":"merge(A::ClimGrid, B::ClimGrid)\n\nCombines two ClimGrid. Based on the AxisArrays method.\n\n\n\n\n\n","category":"method"},{"location":"functions/#Base.minimum-Tuple{ClimGrid}","page":"Index","title":"Base.minimum","text":"minimum(A::ClimGrid)\n\nCompute the minimum value of ClimGrid A\n\n\n\n\n\n","category":"method"},{"location":"functions/#Base.write-Tuple{ClimGrid, String}","page":"Index","title":"Base.write","text":"write(C::ClimGrid, filename::String)\n\nWrite to disk ClimGrid C to netCDF file. Still experimental, some attributes are hardcoded.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.RXday-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.RXday","text":"RXday(C::ClimGrid; days=5)\n\nAnnual maximum consecutive x days precipitation amount (defaults to days=5).\n\nLet RRkj be the precipitation amount for the 5-day interval ending k, period j. Then maximum 5-day values for period j are:\n\nRx5dayj = max (RRkj)\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.annualmax-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.annualmax","text":"annualmax(C::ClimGrid)\n\nAnnual maximum of array data.\n\nLet data[i,j] be daily time serie on day i in year j. Extract the highest value for year j.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.annualmean-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.annualmean","text":"annualmean(C::ClimGrid)\n\nAnnual mean of array data.\n\nLet data[i,j] be daily time serie on day i in year j. Calculate the mean value for year j.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.annualmin-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.annualmin","text":"annualmin(C::ClimGrid)\n\nAnnual minimum of array data.\n\nLet data[i,j] be daily time serie on day i in year j. Extract the lowest value for year j.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.annualsum-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.annualsum","text":"annualsum(C::ClimGrid)\n\nAnnual sum of array data.\n\nLet data[i,j] be daily time serie on day i in year j. Sums daily values for year j.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.applymask-Tuple{AbstractArray{N, 4} where N, AbstractMatrix{N} where N}","page":"Index","title":"ClimateTools.applymask","text":"applymask(A::AbstractArray{N, n}, mask::AbstractArray{N, n})\n\nApplies a mask on the array A. Return an AbstractArray{N, n}.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.approx_surfacepressure-Tuple{ClimGrid, ClimGrid, ClimGrid}","page":"Index","title":"ClimateTools.approx_surfacepressure","text":"approxsurfacepressure(sealevelpressure::ClimGrid, orography::ClimGrid, daily_temperature::ClimGrid)\n\nReturns the approximated surface pressure (sp) (Pa) using sea level pressure (psl) (Pa), orography (orog) (m), and daily mean temperature (tas) (K).\n\nsp = psl * 10^x\n\nwhere x = frac-orog18400 * tas  27315\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.biascorrect_extremes-Tuple{ClimGrid, ClimGrid, ClimGrid}","page":"Index","title":"ClimateTools.biascorrect_extremes","text":"biascorrect_extremes(obs::ClimGrid, ref::ClimGrid, fut::ClimGrid; detrend=false, window::Int=15, rankn::Int=50, thresnan::Float64=0.1, keep_original::Bool=false, interp=Linear(), extrap=Flat(), gev_params::DataFrame, frac=0.25, power=1.0)\n\nCombine the empirial Quantile-Quantile mapping (see qqmap) and Generalized Pareto Distribution bias-correction methods.\n\nThe tail of the distribution is corrected with a paramatric GPD, using provided parameters μ, σ and ξ contained in gevparams DataFrame. The DataFrame gevparams has column :lat, :lon, :mu, :sigma and :xi, representing the GEV parameters and the spatial location of the parameters. For each grid point, the function extracts the closest GEV parameters.\n\nOptions specific to GPD\n\ngevparams::DataFrame represents the (external) GEV parameters to correct each grid-points.\n\nfrac=0.25 is the fraction where the cutoff happens between QQM and GPD, as defined by (maximum(x) - minimum(x))*frac (e.g. For a maximum value of 150mm and a minimum value of 30mm, the linear transition will be between 30mm and 60mm).\n\npower=1.0 is the shape of the transition.\n\nOptions specific to QQM\n\ndetrend::Bool = false (default). A 4th order polynomial is adjusted to the time series and the residuals are corrected.\n\nwindow::Int = 15 (default). The size of the window used to extract the statistical characteristics around a given julian day.\n\nrankn::Int = 50 (default). The number of bins used for the quantile estimations. The quantiles uses by default 50 bins between 0.01 and 0.99. The bahavior between the bins is controlled by the interp keyword argument. The behaviour of the quantile-quantile estimation outside the 0.01 and 0.99 range is controlled by the extrap keyword argument.\n\nthresnan::Float64 = 0.1 (default). The fraction is missing values authorized for the estimation of the quantile-quantile mapping for a given julian days. If there is more than treshnan missing values, the output for this given julian days returns NaNs.\n\nkeep_original::Bool = false (default). If keep_original is set to true, the values are set to the original values in presence of too many NaNs.\n\ninterp = Interpolations.Linear() (default). When the data to be corrected lies between 2 quantile bins, the value of the transfer function is linearly interpolated between the 2 closest quantile estimation. The argument is from Interpolations.jl package.\n\nextrap = Interpolations.Flat() (default). The bahavior of the quantile-quantile transfer function outside the 0.01-0.99 range. Setting it to Flat() ensures that there is no \"inflation problem\" with the bias correction. The argument is from Interpolation.jl package.\n\nSee also: qqmap\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.buildtimetype-Tuple{Any, Any}","page":"Index","title":"ClimateTools.buildtimetype","text":"buildtimetype(datetuple, f)\n\nReturns the adequate DateTime for temporal subsetting using DateType f\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.customthresover-Tuple{ClimGrid, Any}","page":"Index","title":"ClimateTools.customthresover","text":"customthresover(C::ClimGrid, thres)\n\ncustomthresover, annual number of days over a specified threshold.\n\nLet TS[i,j] be a daily time serie value on day i in year j. Count the number of days where:\n\nTS[i,j] > thres.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.customthresunder-Tuple{ClimGrid, Any}","page":"Index","title":"ClimateTools.customthresunder","text":"customthresunder(C::ClimGrid, thres)\n\ncustomthresunder, annual number of days under a specified threshold.\n\nLet TS[i,j] be a daily time serie value on day i in year j. Count the number of days where:\n\nTS[i,j] < thres.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.daymean-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.daymean","text":"daymean(C::ClimGrid)\n\nReturns the daily average given a sub-daily ClimGrid.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.daysum-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.daysum","text":"daysum(C::ClimGrid)\n\nReturns the daily sum given a sub-daily ClimGrid C.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.diurnaltemperature-Tuple{ClimGrid, ClimGrid, Float64}","page":"Index","title":"ClimateTools.diurnaltemperature","text":"diurnaltemperature(temperatureminimum::ClimGrid, temperaturemaximum::ClimGrid, α::Float64)\n\nReturns an estimation of the diurnal temperature (temperature between 7:00 (7am) and 17:00 (5pm)). The estimation is a linear combination of the daily minimum temperature (temperatureminimum) and daily maximum temperature (temperaturemaximum). The value of α has to be estimated seperatly from observations and depends on the location. The daily max and min must be in the same unit and in Celsius or Kelvin The diurnal temperature returned is in the same units as the daily minimum temperature and daily maximum temperature.\n\nTdiu = α * Tmin + (1 - α) * Tmax\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.drought_dc-Tuple{ClimGrid, ClimGrid}","page":"Index","title":"ClimateTools.drought_dc","text":"drought_dc(pr::ClimGrid, tas::Climgrid)\n\nReturns the drought index. The index is defined as a function of daily temperature and daily precipitation. This indice correspond to the DC indice in Wang et al. 2015.\n\nReference: Wang et al. 2015. Updated source code for calculating fire danger indices in the Canadian Forest Fire Weather Index System. Information Report NOR-X-424. Canadian Forst Service. 36pp.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.drought_dc-Tuple{Vector{N} where N, Vector{N} where N, Any}","page":"Index","title":"ClimateTools.drought_dc","text":"drought_dc(prvec::Array{N,1}, tasvec::Array{N,1}, timevec)\n\nReturns the drought index. The index is defined as a function of daily temperature and daily precipitation. This indice correspond to the DC indice in Wang et al. 2015.\n\nReference: Wang et al. 2015. Updated source code for calculating fire danger indices in the Canadian Forest Fire Weather Index System. Information Report NOR-X-424. Canadian Forst Service. 36pp.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.ensemble_max-Tuple{Any}","page":"Index","title":"ClimateTools.ensemble_max","text":"ensemble_max(C::ClimGrid...)\n\nReturns the Ensemble maximum of climatological means of ClimGrids C..\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.ensemble_mean-Tuple{Any}","page":"Index","title":"ClimateTools.ensemble_mean","text":"ensemble_mean(C::ClimGrid...)\n\nReturns the Ensemble mean of ClimGrids C..\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.ensemble_min-Tuple{Any}","page":"Index","title":"ClimateTools.ensemble_min","text":"ensemble_min(C::ClimGrid...)\n\nReturns the Ensemble minimum of climatological means of ClimGrids C..\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.ensemble_std-Tuple{Any}","page":"Index","title":"ClimateTools.ensemble_std","text":"ensemble_std(C::ClimGrid...)\n\nReturns the Ensemble standard deviation of climatological means of ClimGrids C..\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.extractpoly-Tuple{String}","page":"Index","title":"ClimateTools.extractpoly","text":"extractpoly(file::String; n::Int=1)\n\nReturns the n-th polygon contained in file.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.finitemean-Tuple{Any}","page":"Index","title":"ClimateTools.finitemean","text":"finitemean(x,y)\n\nCalculate mean while omitting NaN, Inf, etc.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.frostdays-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.frostdays","text":"frostdays(C::ClimGrid)\n\nFD, Number of frost days: Annual count of days when TN (daily minimum temperature) < 0 Celsius.\n\nLet TN[i,j] be daily minimum temperature on day i in year j. Count the number of days where:\n\nTN[i,j] < 0 Celsius.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.get_calendar-Tuple{NCDataset, Any}","page":"Index","title":"ClimateTools.get_calendar","text":"get_calendar(ds::NCDataset)\n\nReturns the calendar type. See See http://cfconventions.org/.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.get_dimname-Tuple{NCDataset, String}","page":"Index","title":"ClimateTools.get_dimname","text":"get_dimname(::NCDatasets.Dataset, dim::String)\n\nScans dataset ds and extract the dimensions X, Y, Z and T. The dataset needs to be CF-compliant. See http://cfconventions.org/.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.get_timevec-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.get_timevec","text":"get_timevec(C::ClimGrid)\n\nReturns time vector of ClimGrid C.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.getdim_lat-Tuple{NCDataset}","page":"Index","title":"ClimateTools.getdim_lat","text":"getdim_lat(ds::NCDatasets.Dataset)\n\nReturns the name of the \"latitude\" dimension and the status related to a regular grid. The latitude dimension is usually \"latitude\", \"lat\", \"y\", \"yc\", \"rlat\".\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.getdim_lon-Tuple{NCDataset}","page":"Index","title":"ClimateTools.getdim_lon","text":"getdim_lon(ds::NCDatasets.Dataset)\n\nReturns the name of the \"longitude\" dimension and the status related to a regular grid. The longitude dimension is usually \"longitue\", \"lon\", \"x\", \"xc\", \"rlon\".\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.getdim_tim-Tuple{NCDataset}","page":"Index","title":"ClimateTools.getdim_tim","text":"getdim_tim(ds::NCDatasets.Dataset)\n\nReturns the name of the \"time\" dimension.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.griddata-Tuple{ClimGrid, AbstractArray{N, T} where {T, N}, AbstractArray{N, T} where {T, N}}","page":"Index","title":"ClimateTools.griddata","text":"C = griddata(A::ClimGrid, londest::AbstractArray{N, 1} where N, latdest::AbstractArray{N, 1} where N)\n\nInterpolate ClimGrid A onto lat-lon grid defined by londest and latdest vector or array. If an array is provided, it is assumed that the grid is curvilinear (not a regular lon-lat grid) and the user needs to provide the dimension vector (\"x\" and \"y\") for such a grid.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.griddata-Tuple{ClimGrid, ClimGrid}","page":"Index","title":"ClimateTools.griddata","text":"C = griddata(A::ClimGrid, B::ClimGrid; min=[], max=[])\n\nInterpolate ClimGrid A onto the lon-lat grid of ClimGrid B, where A and B are ClimGrid.\n\nMin and max optional keyword are used to constraint the results of the interpolation. For example, interpolating bounded fields can lead to unrealilstic values, such as negative precipitation. In that case, one would use min=0.0 to convert negative precipitation to 0.0.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.icingdays-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.icingdays","text":"icingdays(C::ClimGrid)\n\nID, Number of summer days: Annual count of days when TX (daily maximum temperature) < 0 degree Celsius.\n\nLet TX[i,j] be daily maximum temperature on day i in year j. Count the number of days where:\n\nTX[i,j] < 0 Celsius.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.inpoly-Tuple{Any, Any}","page":"Index","title":"ClimateTools.inpoly","text":"inpoly(p, poly::Matrix)\n\nDetermines if a point is inside a polygon.\n\np – point (x,y) or [x,y]\npoly – polygon vertices [x1 x2 ... xn x1                           y1 y2 ... yn y1]\n\nReturns true if point has an odd winding number.  This should label points as exterior which are inside outcrops.  See test for a test.\n\nAuthor: Github \"Mauro3\" / \"Mauro\"\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.inpolygrid-Tuple{AbstractMatrix{N} where N, AbstractMatrix{N} where N, AbstractMatrix{N} where N}","page":"Index","title":"ClimateTools.inpolygrid","text":"inpolygrid(lon, lat, poly::AbstractArray{N,2} where N)\n\nUsed to test a grid of points. Returns a mask of ones and NaNs of the same size as lon and lat.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.load-Tuple{String, String}","page":"Index","title":"ClimateTools.load","text":"load(file::String, vari::String; poly = Array{Float64}([]), start_date::Tuple, end_date::Tuple, data_units::String = \"\")\n\nReturns a ClimGrid type with the data in file of variable vari inside the polygon poly. Metadata is built-in the ClimGrid type, from the netCDF attributes.\n\nInside the ClimgGrid type, the data is stored into an AxisArray data type, with time, longitude/x and latitude/y dimensions.\n\nThe polygon provided should be in the -180, +180 longitude format. If the polygon crosses the International Date Line, the polygon should be splitted in multiple parts (i.e. multi-polygons).\n\nOptions for data_units are for precipitation : \"mm\", which converts the usual \"kg m-2 s-1\" unit found in netCDF files. For temperature : \"Celsius\", which converts the usual \"Kelvin\" unit.\n\nTemporal subsetting can be done by providing start_date and end-date Tuples of length 1 (year), length 3 (year, month, day) or 6 (hour, minute, second).\n\nNote: load uses CF conventions. If you are unable to read the netCDF file with load, the user will need to read it with low-level functions available in NetCDF.jl package or NCDatasets.jl or re-create standartized netCDF files.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.load-Tuple{Vector{String}, String}","page":"Index","title":"ClimateTools.load","text":"load(files::Array{String,1}, vari::String; poly = ([]), start_date::Date = Date(-4000), end_date::Date = Date(-4000), data_units::String = \"\")\n\nLoads and merge the files contained in the arrar files.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.load2D-Tuple{String, String}","page":"Index","title":"ClimateTools.load2D","text":"load2D(file::String, vari::String; poly=[], data_units::String=\"\")\n\nReturns a 2D array. Should be used for fixed data, such as orography.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.meantemperature-Tuple{ClimGrid, ClimGrid}","page":"Index","title":"ClimateTools.meantemperature","text":"meantemperature(temperatureminimum::ClimGrid, temperaturemaximum::ClimGrid)\n\nReturns the daily mean temperature calculated from the maximum and minimum temperature. Daily maximum and minimum temperature must be in the same units. The mean temperature returned is in the same units as the daily minimum temperature and daily maximum temperature.\n\nTmean = fracTmax + Tmin2\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.meshgrid-Union{Tuple{T}, Tuple{AbstractVector{T}, AbstractVector{T}}} where T","page":"Index","title":"ClimateTools.meshgrid","text":"X, Y = meshgrid{T}(vx::AbstractVector{T}, vy::AbstractVector{T})\n\nThis function creates a 2-D mesh-grid in a format consistent with Matlab's function meshgrid(). XV and YV are vectors.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.monthmean-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.monthmean","text":"monthmean(C::ClimGrid)\n\nReturns monthly means of ClimGrid C.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.monthsum-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.monthsum","text":"monthsum(C::ClimGrid)\n\nReturns monthly sums of ClimGrid C.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.ndgrid-Tuple{AbstractVector{T} where T}","page":"Index","title":"ClimateTools.ndgrid","text":"X, Y = ndgrid(XV, YV)\n\nThis function creates a 2-D mesh-grid in a format consistent with Matlab's function ndgrid(). XV and YV are vectors.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.periodmean-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.periodmean","text":"periodmean(C::ClimGrid; startdate::Tuple, enddate::Tuple)\n\nMean of array data over a given period.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.polyfit-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.polyfit","text":"polyfit(C::ClimGrid)\n\nReturns an array of the polynomials functions of each grid points contained in ClimGrid C.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.polyval-Tuple{ClimGrid, Array{Polynomials.Polynomial{N}, 2} where N}","page":"Index","title":"ClimateTools.polyval","text":"polyval(C::ClimGrid, polynomial::Array{Poly{Float64}})\n\nReturns a ClimGrid containing the values, as estimated from polynomial function polyn.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.prcp1-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.prcp1","text":"prcp1(C::ClimGrid)\n\nAnnual number with preciptation >= 1 mm. This function returns a ClimGrid. Input data should be in mm.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.qqmap-Tuple{ClimGrid, ClimGrid, ClimGrid}","page":"Index","title":"ClimateTools.qqmap","text":"qqmap(obs::ClimGrid, ref::ClimGrid, fut::ClimGrid; method=\"Additive\", detrend=true, window::Int=15, rankn::Int=50, thresnan::Float64=0.1, keep_original::Bool=false, interp::Function = Linear(), extrap::Function = Flat())\n\nQuantile-Quantile mapping bias correction.\n\nFor each julian day of the year (+/- window size), a transfer function is estimated through an empirical quantile-quantile mapping. The quantile-quantile transfer function between ref and obs is etimated on a julian day (and grid-point) basis with a moving window around the julian day. Hence, for a given julian day, the transfer function is then applied to the fut dataset for a given julian day.\n\nOptions\n\nmethod::String = \"Additive\" (default) or \"Multiplicative\". Additive is used for most climate variables. Multiplicative is usually bounded variables such as precipitation and humidity.\n\ndetrend::Bool = true (default). A 4th order polynomial is adjusted to the time series and the residuals are corrected with the quantile-quantile mapping.\n\nwindow::Int = 15 (default). The size of the window used to extract the statistical characteristics around a given julian day.\n\nrankn::Int = 50 (default). The number of bins used for the quantile estimations. The quantiles uses by default 50 bins between 0.01 and 0.99. The bahavior between the bins is controlled by the interp keyword argument. The behaviour of the quantile-quantile estimation outside the 0.01 and 0.99 range is controlled by the extrap keyword argument.\n\nthresnan::Float64 = 0.1 (default). The fraction is missing values authorized for the estimation of the quantile-quantile mapping for a given julian days. If there is more than treshnan missing values, the output for this given julian days returns NaNs.\n\nkeep_original::Bool = false (default). If keep_original is set to true, the values are set to the original values in presence of too many NaNs.\n\ninterp = Interpolations.Linear() (default). When the data to be corrected lies between 2 quantile bins, the value of the transfer function is linearly interpolated between the 2 closest quantile estimation. The argument is from Interpolations.jl package.\n\nextrap = Interpolations.Flat() (default). The bahavior of the quantile-quantile transfer function outside the 0.01-0.99 range. Setting it to Flat() ensures that there is no \"inflation problem\" with the bias correction. The argument is from Interpolation.jl package.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.qqmap-Tuple{Vector{N} where N, Vector{N} where N, Vector{N} where N, Any, Any, Any, Any}","page":"Index","title":"ClimateTools.qqmap","text":"qqmap(obsvec::Array{N,1}, refvec::Array{N,1}, futvec::Array{N,1}, days, obsjul, refjul, futjul; method::String=\"Additive\", detrend::Bool=true, window::Int64=15, rankn::Int64=50, thresnan::Float64=0.1, keeporiginal::Bool=false, interp=Linear(), extrap=Flat())\n\nQuantile-Quantile mapping bias correction for single vector. This is a low level function used by qqmap(A::ClimGrid ..), but can work independently.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.resample-Tuple{ClimGrid, Int64, Int64}","page":"Index","title":"ClimateTools.resample","text":"resample(C::ClimGrid, startmonth::Int64, endmonth::Int64)\n\nReturn a resampled subset of ClimGrid C based on months.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.resample-Tuple{ClimGrid, String}","page":"Index","title":"ClimateTools.resample","text":"resample(C::ClimGrid, season::String)\n\nReturn a resampled subset of ClimGrid C for a given season. Season options are: \"DJF\" (December-February), \"MAM\" (March-May), \"JJA\" (June-August), \"SON\" (September-November)\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.shapefile_coords-Tuple{Shapefile.Polygon}","page":"Index","title":"ClimateTools.shapefile_coords","text":"shapefile_coords(poly::Shapefile.Polygon)\n\nThis function return the polygons contained in shp.shapes[i]. It returns the x and y coordinates vectors.\n\nSee also shapefile_coords_poly, which returns a polygon that ca be used for data extraction of the load.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.shapefile_coords_poly-Tuple{Shapefile.Polygon}","page":"Index","title":"ClimateTools.shapefile_coords_poly","text":"shapefile_coords_poly(poly::Shapefile.Polygon)\n\nReturn the polygons contained in shp.shapes[i]. It returns an array containing the polygons.\n\nSee also shapefile_coords, which returns vectors as opposed to array. Returned polygon is consistent with the data extraction of the load function.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.spatialsubset-Tuple{ClimGrid, Any}","page":"Index","title":"ClimateTools.spatialsubset","text":"spatialsubset(C::ClimGrid, poly::Array{N, 2})\n\nReturns the spatial subset of ClimGrid C. The spatial subset is defined by the polygon poly, defined on a -180, +180 longitude reference.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.summerdays-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.summerdays","text":"summerdays(C::ClimGrid)\n\nSD, Number of summer days: Annual count of days when TX (daily maximum temperature) > 25 degree Celsius.\n\nLet TX[i,j] be daily maximum temperature on day i in year j. Count the number of days where:\n\nTX[i,j] > 25 Celsius.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.temporalsubset-Tuple{ClimGrid, Tuple, Tuple}","page":"Index","title":"ClimateTools.temporalsubset","text":"function temporalsubset(C::ClimGrid, startdate::Date, enddate::Date)\n\nReturns the temporal subset of ClimGrid C. The temporal subset is defined by a start and end date.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.timeindex-Tuple{Any, Tuple, Tuple, Any}","page":"Index","title":"ClimateTools.timeindex","text":"timeindex(timeVec, start_date, end_date, T)\n\nReturn the index of time vector specified by startdate and enddate. T is the DateTime type (see NCDatasets.jl documentation).\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.tropicalnights-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.tropicalnights","text":"tropicalnights(C::ClimGrid)\n\nTropicalNights, Number of tropical nights: Annual count of days when TN (daily maximum temperature) > 20 degree Celsius.\n\nLet TN[i,j] be daily minimum temperature on day i in year j. Count the number of days where:\n\nTN[i,j] > 20 Celsius.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.vaporpressure-NTuple{4, ClimGrid}","page":"Index","title":"ClimateTools.vaporpressure","text":"vaporpressure(specifichumidity::ClimGrid, sealevelpressure::ClimGrid, orography::ClimGrid, daily_temperature::ClimGrid)\n\nReturns the vapor pressure (vp) (Pa) estimated with the specific humidity (q), the sea level pressure (psl) (Pa), the orography (orog) (m) and the daily mean temperature (tas) (K). An approximation of the surface pressure is first computed by using the sea level pressure, orography and the daily mean temperature (see approx_surfacepressure). Then, vapor pressure is calculated by:\n\nvp = fracq * spq+0622\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.vaporpressure-Tuple{ClimGrid, ClimGrid}","page":"Index","title":"ClimateTools.vaporpressure","text":"vaporpressure(surfacepressure::ClimGrid, specifichumidity::ClimGrid)\n\nReturns the vapor pressure (vp) (Pa) based on the surface pressure (sp) (Pa) and the specific humidity (q).\n\nvp = fracq * spq+0622\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.verticalmean-Tuple{ClimGrid}","page":"Index","title":"ClimateTools.verticalmean","text":"verticalmean(C::ClimGrid; startdate::Tuple, enddate::Tuple)\n\nMean of array data over all vertical levels.\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.wbgt-Tuple{ClimGrid, ClimGrid}","page":"Index","title":"ClimateTools.wbgt","text":"wbgt(diurnaltemperature::ClimGrid, vaporpressure::ClimGrid)\n\nReturns the simplified wet-bulb global temperature (wbgt) (Celsius) calculated using the vapor pressure (Pa) of the day and the estimated mean diurnal temperature (Celsius; temperature between 7:00 (7am) and 17:00 (5pm)).\n\nwbgt = 0567 * Tday + 000393 * vp + 394\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.yearmonthdayhour-Tuple{DT} where DT<:Dates.TimeType","page":"Index","title":"ClimateTools.yearmonthdayhour","text":"yearmonthdayhour(dt::AbstractCFDateTime) -> (Int64, Int64, Int64, Int64)\n\nSimultaneously return the year, month, day and hour parts of dt. Author: Alexander-Barth (Github)\n\n\n\n\n\n","category":"method"},{"location":"functions/#Statistics.mean-Tuple{ClimGrid}","page":"Index","title":"Statistics.mean","text":"mean(A::ClimGrid)\n\nCompute the mean of ClimGrid A\n\n\n\n\n\n","category":"method"},{"location":"functions/#Statistics.quantile-Tuple{ClimGrid, Any}","page":"Index","title":"Statistics.quantile","text":"quantile(C::ClimGrid)\n\n\n\n\n\n","category":"method"},{"location":"functions/#Statistics.std-Tuple{ClimGrid}","page":"Index","title":"Statistics.std","text":"std(A::ClimGrid)\n\nCompute the standard deviation of ClimGrid A\n\n\n\n\n\n","category":"method"},{"location":"functions/#Statistics.var-Tuple{ClimGrid}","page":"Index","title":"Statistics.var","text":"var(A::ClimGrid)\n\nCompute the variance of ClimGrid A\n\n\n\n\n\n","category":"method"},{"location":"functions/#ClimateTools.ClimGrid","page":"Index","title":"ClimateTools.ClimGrid","text":"ClimGrid{A <: AxisArray}\n\nIn-memory representation of Climate Forecast netCDF files. struct ClimGrid\n\ndata::AxisArray # Data\n\nlongrid::AbstractArray{N,2} where N # the longitude grid\n\nlatgrid::AbstractArray{N,2} where N # the latitude grid\n\nmsk::Array{N, 2} where N # Data mask (NaNs and 1.0)\n\ngrid_mapping::Dict#{String, Any} # bindings for native grid\n\ndimension_dict::Dict\n\nmodel::String\n\nfrequency::String # Day, month, years\n\nexperiment::String # Historical, RCP4.5, RCP8.5, etc.\n\nrun::String\n\nproject::String # CORDEX, CMIP5, etc.\n\ninstitute::String # UQAM, DMI, etc.\n\nfilename::String # Path of the original file\n\ndataunits::String # Celsius, kelvin, etc.\n\nlatunits::String # latitude coordinate unit\n\nlonunits::String # longitude coordinate unit\n\nvariable::String # Type of variable (i.e. can be the same as \"typeofvar\", but it is changed when calculating indices)\n\ntypeofvar::String # Variable type (e.g. tasmax, tasmin, pr)\n\ntypeofcal::String # Calendar type\n\ntimeattrib::Dict # Time attributes (e.g. days since ... )\n\nvarattribs::Dict # Variable attributes dictionary\n\nglobalattribs::Dict # Global attributes dictionary\n\nend\n\n\n\n\n\n","category":"type"},{"location":"functions/#ClimateTools.ClimGrid-Tuple{Any}","page":"Index","title":"ClimateTools.ClimGrid","text":"ClimGrid(data; longrid=[], latgrid=[], msk=[], grid_mapping=Dict(), dimension_dict=Dict(), model=\"NA\", frequency=\"NA\", experiment=\"NA\", run=\"NA\", project=\"NA\", institute=\"NA\", filename=\"NA\", dataunits=\"NA\", latunits=\"NA\", lonunits=\"NA\", variable=\"NA\", typeofvar=\"NA\", typeofcal=\"NA\", varattribs=Dict(), globalattribs=Dict())\n\nConstructor of the ClimGrid function. Data is an AxisArray. Everything else is optional, but usually needed for further processing (mapping, interpolation, etc...). struct ClimGrid\n\ndata::AxisArray # Data \n\nlongrid::AbstractArray{N,2} where N # the longitude grid \n\nlatgrid::AbstractArray{N,2} where N # the latitude grid \n\nmsk::Array{N, 2} where N # Data mask (NaNs and 1.0) \n\ngrid_mapping::Dict#{String, Any} # bindings for native grid \n\ndimension_dict::Dict\n\nmodel::String\n\nfrequency::String # Day, month, years\n\nexperiment::String # Historical, RCP4.5, RCP8.5, etc.\n\nrun::String\n\nproject::String # CORDEX, CMIP5, etc.\n\ninstitute::String # UQAM, DMI, etc.\n\nfilename::String # Path of the original file\n\ndataunits::String # Celsius, kelvin, etc.\n\nlatunits::String # latitude coordinate unit\n\nlonunits::String # longitude coordinate unit\n\nvariable::String # Type of variable (i.e. can be the same as \"typeofvar\", but it is changed when calculating indices)\n\ntypeofvar::String # Variable type (e.g. tasmax, tasmin, pr)\n\ntypeofcal::String # Calendar type\n\ntimeattrib::Dict # Time attributes (e.g. days since ... )\n\nvarattribs::Dict # Variable attributes dictionary\n\nglobalattribs::Dict # Global attributes dictionary\n\nend\n\n\n\n\n\n","category":"method"},{"location":"indices/#Climate-Indices","page":"Climate Indices","title":"Climate Indices","text":"","category":"section"},{"location":"indices/#Indices","page":"Climate Indices","title":"Indices","text":"","category":"section"},{"location":"indices/","page":"Climate Indices","title":"Climate Indices","text":"More than 20 climate indices are available in the package, such as the annual number of tropical nights, annual maximum and minimum, etc. You can calculate such indices simply with:","category":"page"},{"location":"indices/","page":"Climate Indices","title":"Climate Indices","text":"ind = annualmax(C::ClimGrid)","category":"page"},{"location":"indices/","page":"Climate Indices","title":"Climate Indices","text":"Which returns another ClimGrid. You can also map this ClimGrid with the mapclimgrid function and returns the climatological mean of the annual maximum (e.g. daily precipitation in the example below). A list of indices can be found in the documentation and in the functions.jl source code.","category":"page"},{"location":"indices/","page":"Climate Indices","title":"Climate Indices","text":"mapclimgrid(ind) # mapping the indice previously calculated","category":"page"},{"location":"indices/","page":"Climate Indices","title":"Climate Indices","text":"(Image: BNU-ESM)","category":"page"},{"location":"indices/#Ensemble-mean","page":"Climate Indices","title":"Ensemble mean","text":"","category":"section"},{"location":"indices/","page":"Climate Indices","title":"Climate Indices","text":"You can calculate the ensemble mean with ensemble_mean function, where the input argument is an array of ClimGrids.","category":"page"},{"location":"indices/","page":"Climate Indices","title":"Climate Indices","text":"Abstract example:","category":"page"},{"location":"indices/","page":"Climate Indices","title":"Climate Indices","text":"C_model1 = ClimGrid(...) # model #1\nC_model2 = ClimGrid(...) # model #2\nens = [C_model1, C_model2] # Create an Array of ClimGrids\nE = ensemble_mean(ens) # Returns the mean of all models climatologies","category":"page"},{"location":"indices/#Climate-Indices-2","page":"Climate Indices","title":"Climate Indices","text":"","category":"section"},{"location":"indices/","page":"Climate Indices","title":"Climate Indices","text":"Here's a list of climate indices currently provided by ClimateTools. This list may not be always up-to-date. See here for all exported functions.","category":"page"},{"location":"indices/","page":"Climate Indices","title":"Climate Indices","text":"annualmax\nannualmean\nannualmin\nannualsum\napprox_surfacepressure\ncustomthresover\ncustomthresunder\ndiurnaltemperature\nicingdays\nfrostdays\nprcp1\nsummerdays\ntropicalnights\nvaporpressure\nwbgt","category":"page"},{"location":"indices/#ClimateTools.annualmax","page":"Climate Indices","title":"ClimateTools.annualmax","text":"annualmax(C::ClimGrid)\n\nAnnual maximum of array data.\n\nLet data[i,j] be daily time serie on day i in year j. Extract the highest value for year j.\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.annualmean","page":"Climate Indices","title":"ClimateTools.annualmean","text":"annualmean(C::ClimGrid)\n\nAnnual mean of array data.\n\nLet data[i,j] be daily time serie on day i in year j. Calculate the mean value for year j.\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.annualmin","page":"Climate Indices","title":"ClimateTools.annualmin","text":"annualmin(C::ClimGrid)\n\nAnnual minimum of array data.\n\nLet data[i,j] be daily time serie on day i in year j. Extract the lowest value for year j.\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.annualsum","page":"Climate Indices","title":"ClimateTools.annualsum","text":"annualsum(C::ClimGrid)\n\nAnnual sum of array data.\n\nLet data[i,j] be daily time serie on day i in year j. Sums daily values for year j.\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.approx_surfacepressure","page":"Climate Indices","title":"ClimateTools.approx_surfacepressure","text":"approxsurfacepressure(sealevelpressure::ClimGrid, orography::ClimGrid, daily_temperature::ClimGrid)\n\nReturns the approximated surface pressure (sp) (Pa) using sea level pressure (psl) (Pa), orography (orog) (m), and daily mean temperature (tas) (K).\n\nsp = psl * 10^x\n\nwhere x = frac-orog18400 * tas  27315\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.customthresover","page":"Climate Indices","title":"ClimateTools.customthresover","text":"customthresover(C::ClimGrid, thres)\n\ncustomthresover, annual number of days over a specified threshold.\n\nLet TS[i,j] be a daily time serie value on day i in year j. Count the number of days where:\n\nTS[i,j] > thres.\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.customthresunder","page":"Climate Indices","title":"ClimateTools.customthresunder","text":"customthresunder(C::ClimGrid, thres)\n\ncustomthresunder, annual number of days under a specified threshold.\n\nLet TS[i,j] be a daily time serie value on day i in year j. Count the number of days where:\n\nTS[i,j] < thres.\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.diurnaltemperature","page":"Climate Indices","title":"ClimateTools.diurnaltemperature","text":"diurnaltemperature(temperatureminimum::ClimGrid, temperaturemaximum::ClimGrid, α::Float64)\n\nReturns an estimation of the diurnal temperature (temperature between 7:00 (7am) and 17:00 (5pm)). The estimation is a linear combination of the daily minimum temperature (temperatureminimum) and daily maximum temperature (temperaturemaximum). The value of α has to be estimated seperatly from observations and depends on the location. The daily max and min must be in the same unit and in Celsius or Kelvin The diurnal temperature returned is in the same units as the daily minimum temperature and daily maximum temperature.\n\nTdiu = α * Tmin + (1 - α) * Tmax\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.icingdays","page":"Climate Indices","title":"ClimateTools.icingdays","text":"icingdays(C::ClimGrid)\n\nID, Number of summer days: Annual count of days when TX (daily maximum temperature) < 0 degree Celsius.\n\nLet TX[i,j] be daily maximum temperature on day i in year j. Count the number of days where:\n\nTX[i,j] < 0 Celsius.\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.frostdays","page":"Climate Indices","title":"ClimateTools.frostdays","text":"frostdays(C::ClimGrid)\n\nFD, Number of frost days: Annual count of days when TN (daily minimum temperature) < 0 Celsius.\n\nLet TN[i,j] be daily minimum temperature on day i in year j. Count the number of days where:\n\nTN[i,j] < 0 Celsius.\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.prcp1","page":"Climate Indices","title":"ClimateTools.prcp1","text":"prcp1(C::ClimGrid)\n\nAnnual number with preciptation >= 1 mm. This function returns a ClimGrid. Input data should be in mm.\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.summerdays","page":"Climate Indices","title":"ClimateTools.summerdays","text":"summerdays(C::ClimGrid)\n\nSD, Number of summer days: Annual count of days when TX (daily maximum temperature) > 25 degree Celsius.\n\nLet TX[i,j] be daily maximum temperature on day i in year j. Count the number of days where:\n\nTX[i,j] > 25 Celsius.\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.tropicalnights","page":"Climate Indices","title":"ClimateTools.tropicalnights","text":"tropicalnights(C::ClimGrid)\n\nTropicalNights, Number of tropical nights: Annual count of days when TN (daily maximum temperature) > 20 degree Celsius.\n\nLet TN[i,j] be daily minimum temperature on day i in year j. Count the number of days where:\n\nTN[i,j] > 20 Celsius.\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.vaporpressure","page":"Climate Indices","title":"ClimateTools.vaporpressure","text":"vaporpressure(surfacepressure::ClimGrid, specifichumidity::ClimGrid)\n\nReturns the vapor pressure (vp) (Pa) based on the surface pressure (sp) (Pa) and the specific humidity (q).\n\nvp = fracq * spq+0622\n\n\n\n\n\nvaporpressure(specifichumidity::ClimGrid, sealevelpressure::ClimGrid, orography::ClimGrid, daily_temperature::ClimGrid)\n\nReturns the vapor pressure (vp) (Pa) estimated with the specific humidity (q), the sea level pressure (psl) (Pa), the orography (orog) (m) and the daily mean temperature (tas) (K). An approximation of the surface pressure is first computed by using the sea level pressure, orography and the daily mean temperature (see approx_surfacepressure). Then, vapor pressure is calculated by:\n\nvp = fracq * spq+0622\n\n\n\n\n\n","category":"function"},{"location":"indices/#ClimateTools.wbgt","page":"Climate Indices","title":"ClimateTools.wbgt","text":"wbgt(diurnaltemperature::ClimGrid, vaporpressure::ClimGrid)\n\nReturns the simplified wet-bulb global temperature (wbgt) (Celsius) calculated using the vapor pressure (Pa) of the day and the estimated mean diurnal temperature (Celsius; temperature between 7:00 (7am) and 17:00 (5pm)).\n\nwbgt = 0567 * Tday + 000393 * vp + 394\n\n\n\n\n\n","category":"function"},{"location":"interface/#Interface","page":"Interface","title":"Interface","text":"","category":"section"},{"location":"interface/#Merging-ClimGrid-type","page":"Interface","title":"Merging ClimGrid type","text":"","category":"section"},{"location":"interface/","page":"Interface","title":"Interface","text":"Sometimes, the timeseries are split among multiple files (e.g. climate models outputs). To obtain the complete timeseries, you can merge 2 ClimGrid. The method is based on AxisArrays merging method and is overloaded for the ClimGrid type.","category":"page"},{"location":"interface/","page":"Interface","title":"Interface","text":"C = merge(C1::ClimGrid, C2::ClimGrid)","category":"page"},{"location":"interface/","page":"Interface","title":"Interface","text":"To merge multiple ClimGrid form an array of files, load has a method that accepts an array of files to merge.","category":"page"},{"location":"interface/#Operators","page":"Interface","title":"Operators","text":"","category":"section"},{"location":"interface/","page":"Interface","title":"Interface","text":"Basic statistical functions are overloaded on ClimGrid.","category":"page"},{"location":"interface/","page":"Interface","title":"Interface","text":"mean minimum maximum std var","category":"page"},{"location":"interface/","page":"Interface","title":"Interface","text":"Basic arithmetic operators are also loaded.","category":"page"},{"location":"interface/","page":"Interface","title":"Interface","text":"D = C + 2.0 # will add 2.0 to all elements of C\nD = C::ClimGrid - A::ClimGrid # subtract A from C (useful for climatological difference between a future and historical period\nD = C / A # Ratio of 2 ClimGrids","category":"page"},{"location":"interface/#Exporting","page":"Interface","title":"Exporting","text":"","category":"section"},{"location":"interface/","page":"Interface","title":"Interface","text":"Exporting a ClimGrid to disk to a netCDF format can be done with the write function.","category":"page"},{"location":"interface/","page":"Interface","title":"Interface","text":"write(C::ClimGrid, filename::String)","category":"page"},{"location":"maps/","page":"Visualization","title":"Visualization","text":"CurrentModule = ClimateTools","category":"page"},{"location":"maps/#Visualization","page":"Visualization","title":"Visualization","text":"","category":"section"},{"location":"maps/","page":"Visualization","title":"Visualization","text":"Maps and plots are provided by the ClimatePlots package. See here for some examples.","category":"page"},{"location":"examples/#Examples","page":"Examples","title":"Examples","text":"","category":"section"},{"location":"examples/#Typical-workflow-for-a-climate-scenario","page":"Examples","title":"Typical workflow for a climate scenario","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"Note. Climate data can be downloaded at ESGF nodes","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"Note 2. The following example is somewhat convoluted, but it gives an overview of the main steps allowed by ClimateTools package.","category":"page"},{"location":"examples/#Exploration","page":"Examples","title":"Exploration","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"First step before extracting the data is to explore the actual dataset at hand. The function Dataset (reexported from te NCDatasets.jl package) is used to examine the file(s). In this example, the simulation is from the MIROC5 model.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"Dataset(\"datafile.nc\")\n\nDataset: /path/to/file/tasmax_day_MIROC5_historical_r1i1p1_19900101-19991231.nc\nGroup: /\n\nDimensions\n   time = 3650\n   lat = 128\n   lon = 256\n   bnds = 2\n\nVariables\n  time   (3650)\n    Datatype:    Float64\n    Dimensions:  time\n    Attributes:\n     bounds               = time_bnds\n     units                = days since 1850-1-1\n     calendar             = noleap\n     axis                 = T\n     long_name            = time\n     standard_name        = time\n\n  time_bnds   (2 × 3650)\n    Datatype:    Float64\n    Dimensions:  bnds × time\n\n  lat   (128)\n    Datatype:    Float64\n    Dimensions:  lat\n    Attributes:\n     bounds               = lat_bnds\n     units                = degrees_north\n     axis                 = Y\n     long_name            = latitude\n     standard_name        = latitude\n\n  lat_bnds   (2 × 128)\n    Datatype:    Float64\n    Dimensions:  bnds × lat\n\n  lon   (256)\n    Datatype:    Float64\n    Dimensions:  lon\n    Attributes:\n     bounds               = lon_bnds\n     units                = degrees_east\n     axis                 = X\n     long_name            = longitude\n     standard_name        = longitude\n\n  lon_bnds   (2 × 256)\n    Datatype:    Float64\n    Dimensions:  bnds × lon\n\n  height  \n    Attributes:\n     units                = m\n     axis                 = Z\n     positive             = up\n     long_name            = height\n     standard_name        = height\n\n  tasmax   (256 × 128 × 3650)\n    Datatype:    Float32\n    Dimensions:  lon × lat × time\n    Attributes:\n     standard_name        = air_temperature\n     long_name            = Daily Maximum Near-Surface Air Temperature\n     units                = K\n     original_name        = T2\n     cell_methods         = time: maximum\n     cell_measures        = area: areacella\n     history              = 2011-10-19T12:39:31Z altered by CMOR: Treated scalar dimension: 'height'. 2011-10-19T12:39:31Z altered by CMOR: replaced missing value flag (-999) with standard missing value (1e+20). 2011-10-19T12:39:31Z altered by CMOR: Inverted axis: lat.\n     coordinates          = height\n     missing_value        = 1.0e20\n     _FillValue           = 1.0e20\n     associated_files     = baseURL: http://cmip-pcmdi.llnl.gov/CMIP5/dataLocation gridspecFile: gridspec_atmos_fx_MIROC5_historical_r0i0p0.nc areacella: areacella_fx_MIROC5_historical_r0i0p0.nc\n\nGlobal attributes\n  institution          = AORI (Atmosphere and Ocean Research Institute, The University of Tokyo, Chiba, Japan), NIES (National Institute for Environmental Studies, Ibaraki, Japan), JAMSTEC (Japan Agency for Marine-Earth Science and Technology, Kanagawa, Japan)\n  institute_id         = MIROC\n  experiment_id        = historical\n  source               = MIROC5 2010 atmosphere: MIROC-AGCM6 (T85L40); ocean: COCO (COCO4.5, 256x224 L50); sea ice: COCO (COCO4.5); land: MATSIRO (MATSIRO, L6); aerosols: SPRINTARS (SPRINTARS 5.00, T85L40)\n  model_id             = MIROC5\n  forcing              = GHG, SA, Oz, LU, Sl, Vl, SS, Ds, BC, MD, OC (GHG includes CO2, N2O, methane, and fluorocarbons; Oz includes OH and H2O2; LU excludes change in lake fraction)\n  parent_experiment_id = piControl\n  parent_experiment_rip = r1i1p1\n  branch_time          = 150015.0\n  contact              = Masahiro Watanabe (hiro@aori.u-tokyo.ac.jp), Seita Emori (emori@nies.go.jp), Masayoshi Ishii (ism@jamstec.go.jp), Masahide Kimoto (kimoto@aori.u-tokyo.ac.jp)\n  references           = Watanabe et al., 2010: Improved climate simulation by MIROC5: Mean states, variability, and climate sensitivity. J. Climate, 23, 6312-6335\n  initialization_method = 1\n  physics_version      = 1\n  tracking_id          = 54e617f1-31a5-47fd-bd57-8736bb7d00ef\n  product              = output\n  experiment           = historical\n  frequency            = day\n  creation_date        = 2011-10-19T12:39:31Z\n  history              = 2011-10-19T12:39:31Z CMOR rewrote data to comply with CF standards and CMIP5 requirements.\n  Conventions          = CF-1.4\n  project_id           = CMIP5\n  table_id             = Table day (26 July 2011) f21c16b785432e6bd3f72e80f2cade49\n  title                = MIROC5 model output prepared for CMIP5 historical\n  parent_experiment    = pre-industrial control\n  modeling_realm       = atmos\n  realization          = 1\n  cmor_version         = 2.7.1\n","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"You can see the dimensions of the data, as well as the name of the variable(s), in this case \"tasmax\".","category":"page"},{"location":"examples/#Extraction","page":"Examples","title":"Extraction","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"Now, say you need to create a climate scenario, using a given simulation, over a region defined by the following polygon.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"poly_reg = [[NaN -65 -80 -80 -65 -65];[NaN 42 42 52 52 42]]\n2×6 Array{Float64,2}:\n NaN  -65.0  -80.0  -80.0  -65.0  -65.0\n NaN   42.0   42.0   52.0   52.0   42.0","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"The extraction of the desired variable can be done with the load function, by providing the polygon.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"gcmfiles =[\"tasmax_day_MIROC5_historical_r1i1p1_19800101-19891231.nc\",\n\"tasmax_day_MIROC5_historical_r1i1p1_19900101-19991231.nc\",\n\"tasmax_day_MIROC5_historical_r1i1p1_20000101-20091231.nc\"]\n\nmodel = load(gcm_files, \"tasmax\", poly=poly_reg)\nClimGrid struct with data:\n   3-dimensional AxisArray{Float32,3,...} with axes:    \n    :lon, [-78.75, -77.3438, -75.9375, -74.5313, -73.125, -71.7188, -70.3125, -68.9063, -67.5, -66.0938]\n    :lat, [42.7233, 44.1241, 45.5249, 46.9256, 48.3264, 49.7271, 51.1279]\n    :time, Date[1980-01-01, 1980-01-02, 1980-01-03, 1980-01-04, 1980-01-05, 1980-01-06, 1980-01-07, 1980-01-08, 1980-01-09, 1980-01-10  …  2009-12-22, 2009-12-23, 2009-12-24, 2009-12-25, 2009-12-26, 2009-12-27, 2009-12-28, 2009-12-29, 2009-12-30, 2009-12-31]\nAnd data, a 10×7×10950 Array{Float32,3}\nProject: CMIP5\nInstitute: MIROC\nModel: MIROC5\nExperiment: historical\nRun: r1i1p1\nVariable: tasmax\nData units: K\nFrequency: day\nGlobal attributes: Dict{Any,Any} with 27 entries\nFilename: tasmax_day_MIROC5_historical_r1i1p1_19800101-19891231.nc","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"One possible verification of the extracted data is to map the time-mean data with the mapclimgrid function to see if there is something wrong.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"mapclimgrid(model, region = \"Quebec\")","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"Which should return the following map.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"(Image: MIROC5)","category":"page"},{"location":"examples/#Sidenote:-merging-files/data","page":"Examples","title":"Sidenote: merging files/data","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"Climate data files are usually on the order of multiple GBs and institution generally split a single simulation into multiple files. In order to calculate climatologies, it is thus essential to merge the data into a single structure. The function merge is provided to combine 2 ClimGrid.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"C = merge(C1, C2) # merge C1 with C2","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"The merge function is useful when you have 2 or 3 files. However, a single simulation can sometimes be splitted into yearly files. Hence, extracting timeseries on climatological timescales can imply loading more than a hundred files just to get a complete timeserie for a given gridpoint. The function load has a method where the 1st positional argument is an Array of strings (as opposed to a single string).","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"C = load(strarray::Array{String,1}, variable::String; poly, start_date::Tuple, end_date::Tuple, data_units::String))","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"This is how the MIROC5 simulation has been loaded.","category":"page"},{"location":"examples/#Bias-correction","page":"Examples","title":"Bias correction","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"An important step in climate scenarios design is to correct the statistical bias of the simulations compared against a chosen reference (more often than not, weather observations). A typical method is to do quantile-quantile mapping between the simulation timeseries and observed timeseries. The function qqmap does so. First step would be to interpolate the simulated field onto the reference grid. Here we use the dataset provided by the Canadian Forest Service (McKenney et al. 2011) for the interpolation step and the bias correction step.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"McKenney, D. W., Hutchinson, M.F., Papadopol, P., Lawrence, K., Pedlar, J., Campbell, K., Milewska, E., Hopkinson, R., Price, D., Owen, T. (2011). \"Customized spatial climate models for North America.\" Bulletin of American Meteorological Society-BAMS December: 1612-1622.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"obsfiles = [\"nrcan_canada_daily_tasmax_1950.nc\",\n\"nrcan_canada_daily_tasmax_1951.nc\",\n\"nrcan_canada_daily_tasmax_1952.nc\",\n\"nrcan_canada_daily_tasmax_1953.nc\",\n\"nrcan_canada_daily_tasmax_1954.nc\",\n\"nrcan_canada_daily_tasmax_1955.nc\",\n\"nrcan_canada_daily_tasmax_1956.nc\",\n\"nrcan_canada_daily_tasmax_1957.nc\",\n\"nrcan_canada_daily_tasmax_1958.nc\",\n\"nrcan_canada_daily_tasmax_1959.nc\",\n\"nrcan_canada_daily_tasmax_1960.nc\",\n\"nrcan_canada_daily_tasmax_1961.nc\",\n\"nrcan_canada_daily_tasmax_1962.nc\",\n\"nrcan_canada_daily_tasmax_1963.nc\",\n\"nrcan_canada_daily_tasmax_1964.nc\",\n\"nrcan_canada_daily_tasmax_1965.nc\",\n\"nrcan_canada_daily_tasmax_1966.nc\",\n\"nrcan_canada_daily_tasmax_1967.nc\",\n\"nrcan_canada_daily_tasmax_1968.nc\",\n\"nrcan_canada_daily_tasmax_1969.nc\"]\n\nobs = load(obsfiles, \"tasmax\", poly=poly_reg)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"mapclimgrid(obs, region = \"Quebec\", titlestr=\"Gridded Obs, 1980-2009\")","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"(Image: NRCAN)","category":"page"},{"location":"examples/#Interpolation-/-Regridding","page":"Examples","title":"Interpolation / Regridding","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"The interpolation is done with the regrid function. The following command interpolate the values of ClimGrid model onto the grid of ClimGrid obs.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"modelinterp = regrid(model, obs)\nProgress: 100%|█████████████████████████████████████████| Time: 0:00:38\nClimGrid struct with data:\n   3-dimensional AxisArray{Float64,3,...} with axes:    \n    :lon, Float32[-79.9583, -79.875, -79.7917, -79.7083, -79.625, -79.5417, -79.4583, -79.375, -79.2917, -79.2083  …  -65.7917, -65.7083, -65.625, -65.5417, -65.4583, -65.375, -65.2917, -65.2083, -65.125, -65.0417]\n    :lat, Float32[51.9583, 51.875, 51.7917, 51.7083, 51.625, 51.5417, 51.4583, 51.375, 51.2917, 51.2083  …  42.7917, 42.7083, 42.625, 42.5417, 42.4583, 42.375, 42.2917, 42.2083, 42.125, 42.0417]\n    :time, Date[1980-01-01, 1980-01-02, 1980-01-03, 1980-01-04, 1980-01-05, 1980-01-06, 1980-01-07, 1980-01-08, 1980-01-09, 1980-01-10  …  2009-12-22, 2009-12-23, 2009-12-24, 2009-12-25, 2009-12-26, 2009-12-27, 2009-12-28, 2009-12-29, 2009-12-30, 2009-12-31]\nAnd data, a 180×120×10950 Array{Float64,3}\nProject: CMIP5\nInstitute: MIROC\nModel: MIROC5\nExperiment: historical\nRun: r1i1p1\nVariable: tasmax\nData units: K\nFrequency: day\nGlobal attributes: Dict{Any,Any} with 27 entries\nFilename: tasmax_day_MIROC5_historical_r1i1p1_19800101-19891231.nc","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"julia> mapclimgrid(modelinterp, region = \"Quebec\", titlestr=\"MIROC5 - Interpolated - 1980-2009\")","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"(Image: MIROC5_INTERP)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"Notice that there is no new information created here. The interpolation is using Scipy's griddata under the hood and is simply a linear interpolation onto the obs grid.","category":"page"},{"location":"examples/#Quantile-quantile-mapping","page":"Examples","title":"Quantile-quantile mapping","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"The high-resolution local information is integrated into ClimGrid modelinterp at the bias correction step. There is a daily transfer function applied on a quantile basis.The call signature is qqmap(obs, ref, fut) where the transfer function is estimated between obs and ref and applied on fut. Note that ref and fut can be the same, as in this example. A typical use-case would be obs and ref covering the same (historical, e.g. 1961-2010) temporal window and fut being a simulation covering a future climatological period (which could be a mix of historic and future, such as 1961-2090). This step is computationally intensive (uses of multiple threads can help here if set by the user).","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"model_qqmap = qqmap(obs, modelinterp, modelinterp)\nProgress: 100%|█████████████████████████████████████████| Time: 0:11:20\nClimGrid struct with data:\n   3-dimensional AxisArray{Float64,3,...} with axes:    \n    :lon, Float32[-79.9583, -79.875, -79.7917, -79.7083, -79.625, -79.5417, -79.4583, -79.375, -79.2917, -79.2083  …  -65.7917, -65.7083, -65.625, -65.5417, -65.4583, -65.375, -65.2917, -65.2083, -65.125, -65.0417]\n    :lat, Float32[51.9583, 51.875, 51.7917, 51.7083, 51.625, 51.5417, 51.4583, 51.375, 51.2917, 51.2083  …  42.7917, 42.7083, 42.625, 42.5417, 42.4583, 42.375, 42.2917, 42.2083, 42.125, 42.0417]\n    :time, Date[1980-01-01, 1980-01-02, 1980-01-03, 1980-01-04, 1980-01-05, 1980-01-06, 1980-01-07, 1980-01-08, 1980-01-09, 1980-01-10  …  2009-12-22, 2009-12-23, 2009-12-24, 2009-12-25, 2009-12-26, 2009-12-27, 2009-12-28, 2009-12-29, 2009-12-30, 2009-12-31]\nAnd data, a 180×120×10950 Array{Float64,3}\nProject: CMIP5\nInstitute: MIROC\nModel: MIROC5\nExperiment: historical\nRun: r1i1p1\nVariable: tasmax\nData units: K\nFrequency: NA\nGlobal attributes: Dict{Any,Any} with 0 entries\nFilename: tasmax_day_MIROC5_historical_r1i1p1_19800101-19891231.nc","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"Mapping the results show that the local information is integrated into the model, and that the natural \"mask\" of the observation grid is applied naturally.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"mapclimgrid(model_qqmap, region = \"Quebec\", titlestr=\"MIROC5 - Interpolated and Quantile-Quantile corrected - 1980-2009\")","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"(Image: MIROC5_QQMAP)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"Proper assessment of future climate conditions over the specified region would involve replicating these steps for minimally a dozen simulations from multiple models and different emission scenarios (e.g. RCP4.5, RCP8.5, etc.).","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"We can show the effect of bias correction by simply subtracting model_qqmap from modelinterp.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"mapclimgrid(modelinterp-model_qqmap, region = \"qc\", titlestr=\"MIROC5 - bias correction effect - 1980-2009\", center_cs=true)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"(Image: MIROC5_effect)","category":"page"},{"location":"examples/#Climate-indices","page":"Examples","title":"Climate indices","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"Once the climate data is downscaled (interpolation and bias correction) to the proper scale, the user can compute climate indices. For example, annual maximum values of daily maximum temperature could be desired (annualmax).","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"annmax = annualmax(model_qqmap)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"The return value of climate indices functions are another ClimGrid, but at the yearly scale in the case of annual maximum. Maps and timeseries can be plotted with mapclimgrid and plot respectively.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"Here's the effect of bias correcting on annual maximum values.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"max_obs = annualmax(obs)\nmax_modelinterp = annualmax(modelinterp)\nmax_modelqqmap = annualmax(model_qqmap)\n\n# Plots\nplot(max_obs, label=\"OBS\")\nplot(max_modelinterp, label=\"MIROC5 - interpolated\")\nplot(max_modelqqmap, label=\"MIROC5 - bias corrected\", titlefig = \"Effect of bias correction on annual maximum values\")","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"(Image: timeseries)","category":"page"},{"location":"examples/#Exporting","page":"Examples","title":"Exporting","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"Once calculations are done, results can be written to disk to a netCDF file with the write command. Here, we export the annual maximum values of the bias corrected model to the current folder.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"write(max_modelqqmap, \"annualmax_model_qqmap.nc\")","category":"page"},{"location":"installation/#Installation","page":"Installation","title":"Installation","text":"","category":"section"},{"location":"installation/#Installing-ClimateTools.jl","page":"Installation","title":"Installing ClimateTools.jl","text":"","category":"section"},{"location":"installation/","page":"Installation","title":"Installation","text":"Once the Python dependencies are properly installed you can then install ClimateTools in Julia.","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"pkg> add ClimateTools # Tagged release","category":"page"},{"location":"installation/#Installing-ClimatePlots.jl","page":"Installation","title":"Installing ClimatePlots.jl","text":"","category":"section"},{"location":"installation/","page":"Installation","title":"Installation","text":"Plotting data and results is done through the ClimatePlots.jl package.","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"Under the hood, ClimatePlots.jl requires some Python packages for mapping purpose and is currently using Cartopy. To ensure that ClimatePlots works properly, it is recommended to use Julia's built-in Python distribution which can properly load the required Python packages.","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"Hence, the best approach is to simply configure PyCall as follows:","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"julia> using Pkg; Pkg.add(\"PyCall\")\njulia> ENV[\"PYTHON\"]=\"\"\njulia> Pkg.build(\"PyCall\")","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"Then, once PyCall configured, installation is the standard command.","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"pkg> add ClimatePlots # Tagged release","category":"page"},{"location":"installation/#Alternatives-Python-distribution","page":"Installation","title":"Alternatives Python distribution","text":"","category":"section"},{"location":"installation/","page":"Installation","title":"Installation","text":"It is also possible to use your own Python distribution instead of Julia's Python.","category":"page"},{"location":"installation/#Approach-no.-1-Use-Anaconda-or-main-system-Python-distribution","page":"Installation","title":"Approach no. 1 Use Anaconda or main system Python distribution","text":"","category":"section"},{"location":"installation/","page":"Installation","title":"Installation","text":"The first approach is to use Anaconda or the system Python distribution and ensure that you can import the following packages. By far, the easiest solution is to use Anaconda, which can easily install the Basemap dependency.","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"1.1 Python dependencies","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"matplotlib\ncartopy\ncmocean","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"1.2 Testing Python installation","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"No matter the approach used, it is recommended to test the Python environment and see if you can import the required Python packages.","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"#python\n>>> import cartopy\n>>> import matplotlib.pyplot as plt\n>>> import cmocean as cm","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"1.2 Building PyCall After the confirmation that the Python dependencies can be loaded in Python, the user needs to build PyCall with the same Python version. Alternatively, if PyCall is already built, it may be only a matter of installing the Python dependencies with the PyCall's Python version by using pip.","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"ENV[\"PYTHON\"]=\"path_to_python_distribution\"\npkg> build PyCall","category":"page"},{"location":"installation/#Approach-no.-2.-Use-a-Conda-virtual-environment-and-link-PyCall.jl-to-it","page":"Installation","title":"Approach no. 2. Use a Conda virtual environment and link PyCall.jl to it","text":"","category":"section"},{"location":"installation/","page":"Installation","title":"Installation","text":"If the main system Python distribution is not set-up properly, the recommended approach is to use a Conda environment. Cartopy is much easier to install through this approach. It is simply a matter of creating a virtual Python environment with Conda and installing the required packages and then linking Julia's PyCall.jl package to this virtual Conda environment. More information can be found in PyCall documentation for custom Conda environment.","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"Create a virtual environment with Conda","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"$ conda create -name ClimateTools python=3.6\n$ conda activate ClimateTools\n$ conda install -c conda-forge matplotlib --strict-channel-priority\n$ conda install -c conda-forge cartopy --strict-channel-priority\n$ conda install -c conda-forge cmocean --strict-channel-priority\n$ which python # gives you the path of Conda virtual environment to use in the next steps.","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"Once those packages are installed, you need to tell PyCall.jl (in Julia) to use this Conda environment in Julia.","category":"page"},{"location":"installation/","page":"Installation","title":"Installation","text":"julia> using PyCall\njulia> ENV[\"PYTHON\"]=\"...PATH TO CONDA PYTHON...\" # find the path with \"which python\" at previous step\njulia> using Pkg; Pkg.build(\"PyCall\")","category":"page"},{"location":"biascorrection/#Bias-correction","page":"Bias correction","title":"Bias correction","text":"","category":"section"},{"location":"biascorrection/","page":"Bias correction","title":"Bias correction","text":"Quantile-quantile mapping (Themeßl et al. 2012, Grenier et al. 2015) is provided with ClimateTools.jl through the function qqmap.","category":"page"},{"location":"biascorrection/","page":"Bias correction","title":"Bias correction","text":"qqmap(obs::ClimGrid, ref::ClimGrid, fut::ClimGrid; method::String=\"Additive\", detrend::Bool=true, window::Int=15, rankn::Int=50, thresnan::Float64=0.1, keep_original::Bool=false, interp = Linear(), extrap = Flat())","category":"page"},{"location":"biascorrection/","page":"Bias correction","title":"Bias correction","text":"More information can be found in these references.","category":"page"},{"location":"biascorrection/","page":"Bias correction","title":"Bias correction","text":"Themeßl, Matthias Jakob, Andreas Gobiet, and Georg Heinrich. 2012. “Empirical-Statistical Downscaling and Error Correction of Regional Climate Models and Its Impact on the Climate Change Signal.” Climatic Change 112 (2). Springer: 449–68.","category":"page"},{"location":"biascorrection/","page":"Bias correction","title":"Bias correction","text":"Grenier, Patrick, Ramón de Elía, and Diane Chaumont. 2015. “Chances of Short-Term Cooling Estimated from a Selection of CMIP5-Based Climate Scenarios during 2006-2035 over Canada.” Journal of Climate, January 2015. American Meteorological Society. doi:10.1175/JCLI-D-14-00224.1.","category":"page"},{"location":"interpolation/#Interpolation","page":"Interpolation","title":"Interpolation","text":"","category":"section"},{"location":"interpolation/","page":"Interpolation","title":"Interpolation","text":"A typical step in climate analysis is to interpolate a given grid onto another grid. ClimateTools provides such a tool by wrapping Scipy griddata function. It is intended for visualization or as a 1st step before bias-correcting the ClimGrid dataset.","category":"page"},{"location":"interpolation/","page":"Interpolation","title":"Interpolation","text":"griddata function will interpolate the data contained in ClimGrid A into the coordinates of ClimGrid B and returns a new ClimGrid C which contains the interpolated data of A into the grid of B.","category":"page"},{"location":"interpolation/","page":"Interpolation","title":"Interpolation","text":"C = griddata(A::ClimGrid, B::ClimGrid)","category":"page"},{"location":"interpolation/","page":"Interpolation","title":"Interpolation","text":"It is also possible to interpolate a ClimGrid onto specified longitude and latitude vectors and arrays.","category":"page"},{"location":"interpolation/","page":"Interpolation","title":"Interpolation","text":"C = griddata(A::ClimGrid, lon::AbstractArray{N, T} where N where T, lat::AbstractArray{N, T} where N where T; dimx=[], dimy=[], method::String=\"linear\", min=[], max=[])","category":"page"},{"location":"interpolation/","page":"Interpolation","title":"Interpolation","text":"In the case a longitude and latitude 2D array is provided, the user needs to provide the dimension vectors for x and y.","category":"page"},{"location":"interpolation/#Experimental","page":"Interpolation","title":"Experimental","text":"","category":"section"},{"location":"interpolation/","page":"Interpolation","title":"Interpolation","text":"DEPRECATED. Users will have to define their own regridding functions using GeoStats.","category":"page"},{"location":"interpolation/","page":"Interpolation","title":"Interpolation","text":"ClimateTools also provide a way to uses GeoStats geostatistics methods. See function regrid for some details.","category":"page"},{"location":"interpolation/","page":"Interpolation","title":"Interpolation","text":"using GeoStats\nusing ClimateTools\n\ntarget = :pr # e.g. precipitation\nn = 30 # max number of neighboring points\nsolver = Kriging(target => (maxneighbors=n,))\n\nC = regrid(A::ClimGrid, B::ClimGrid, solver=solver)","category":"page"},{"location":"#Home","page":"Home","title":"Home","text":"","category":"section"},{"location":"#Overview","page":"Home","title":"Overview","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"ClimateTools.jl is a collection of commonly-used tools in Climate science. Basics of climate field analysis will be covered, with some forays into exploratory techniques. The package is aimed to ease the typical steps of analysis climate models outputs from netCDF files that follows Climate Forecast conventions and the creation of climate scenarios.","category":"page"},{"location":"#Philosophy","page":"Home","title":"Philosophy","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The idea behind ClimateTools is that most, if not all, climate fields can be represented by a 2D (e.g. topography), 3D (e.g. air temperature) or 4D (e.g. winds at multiple levels) grids that are georeferenced. Those grids are named ClimGrid in ClimateTools. Every functions acts on such structure and returns a similar structure. The ClimGrid structure contains all elements needed to be manipulated: latitude, longitude, calendars, variable attributes, etc. that was either available in the original netCDF file or that was inferred by the metadata. Note that a ClimGrid is defined for a single variable.","category":"page"},{"location":"","page":"Home","title":"Home","text":"The metadata follows the various transformations and is modified when necessary. For example, calculating the annual number of days with precipitation higher than 1mm will modify the variable name from pr (for precipitation) to prcp1, the name of the indicator. It will not, however, modify the base variable type (it will remain pr).","category":"page"},{"location":"#Notes","page":"Home","title":"Notes","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The climate indices and bias correction functions are coded to leverage multiple threads. To gain maximum performance, use (bash shell Linux/MacOSX) export JULIA_NUM_THREADS=n, where n is the number of threads. To get an idea of the number of threads you can use type (in Julia) Sys.THREADS. This is especially useful for bias correction.","category":"page"},{"location":"#Features","page":"Home","title":"Features","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Climate scenarios creation\nExtraction and visualization of CF-compliant netCDF datasets\nCustom user-provided polygons and start and end date for localized studies\nClimate indices from The joint CCl/CLIVAR/JCOMM Expert Team (ET) on Climate Change Detection and Indices (ETCCDI) as well as custom climate indices\nRegridding of a datasets onto another grid\nPost-processing of climate timeseries using Quantile-Quantile mapping method (cf. Themeßl et al. 2012, Piani et al. 2010)\nExportation of results to a CF-compliant netCDF file\nSupport for typical climate models calendars: 360day, 365day, Standard, Prolectip Gregorian through NCDatasets.jl.\nSupport for physical units through the Unitful.jl package.","category":"page"},{"location":"#Contributors","page":"Home","title":"Contributors","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"If you'd like to have other climate indices coded, please, submit them through a Pull Request! I'd be more than happy to include them. Alternatively, provide the equation in Issues.","category":"page"},{"location":"#TO-DO","page":"Home","title":"TO-DO","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Dashboard tool. This will return the main characteristics of a ClimGrid: maps of minimum, maximum and mean climatological values, seasonal cycle, timeseries of annual maximum, minimum and mean values, etc...\nExtreme value theory analysis","category":"page"},{"location":"#Documentation","page":"Home","title":"Documentation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"This documentation was built using Documenter.jl.","category":"page"},{"location":"","page":"Home","title":"Home","text":"using Dates # hide\nprintln(\"Documentation built $(Dates.now()) with Julia $(VERSION)\") # hide","category":"page"},{"location":"datasets/#Datasets","page":"Datasets","title":"Datasets","text":"","category":"section"},{"location":"datasets/#Importing-a-NetCDF-dataset","page":"Datasets","title":"Importing a NetCDF dataset","text":"","category":"section"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"The entry point of ClimateTools is to load data with the load function. The return structure of the load function is a in-memory representation of the variable contained in the netCDF file.","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"For a single-file dataset.","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"C = load(filename::String, vari::String; poly::Array, data_units::String, start_date::Tuple, end_date::Tuple, dimension::Bool=true)","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"or, for a multi-file datasets.","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"C = load(filename::Array{String}, vari::String; poly::Array, data_units::String, start_date::Tuple, end_date::Tuple, dimension::Bool=true)","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"load return a ClimGrid type. The ClimGrid represent a single variable. By default, the function tries to attach physical units to the data array by using the Unitful.jl package. The advantage behind physical units is that one can subtract a ClimGrid with Kelvin unit with a ClimGrid with Celsius unit and get coherent results. Be warned that some operations on some units are not allowed (you cannot \"add\" Celsius for instance). In the event that a user wants to do some calculations without physical logic, it is possible to load the dataset without the units by specifying dimension=false argument.","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"Using the optional poly argument, the user can provide a polygon and the returned ClimGrid will only contains the grid points inside the provided polygon. The polygon provided should be in the -180, +180 longitude format. If the polygon crosses the International Date Line, the polygon should be splitted in multiple parts (i.e. multi-polygons).","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"start_date and end_date can also be provided. It is useful when climate simulations file spans multiple decades/centuries and only a temporal subset is needed. Dates should be provided as a Tuple of the form (year, month, day, hour, minute, seconds), where only year is mandatory (e.g. (2000,) can be provided and will defaults to (2000, 01, 01)).","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"For some variable, the optional keyword argument data_units can be provided. For example, precipitation in climate models are usually provided as kg/m^2/s. By specifying data_units = mm, the load function returns accumulation at the data time resolution. Similarly, the user can provide Celsius as data_units and load will return Celsius instead of Kelvin.","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"struct ClimGrid\n  data::AxisArray # Data\n  longrid::AbstractArray{N,2} where N # the longitude grid\n  latgrid::AbstractArray{N,2} where N # the latitude grid\n  msk::Array{N, 2} where N # Data mask (NaNs and 1.0)\n  grid_mapping::Dict#{String, Any} # bindings for native grid\n  dimension_dict::Dict\n  model::String\n  frequency::String # Day, month, years\n  experiment::String # Historical, RCP4.5, RCP8.5, etc.\n  run::String\n  project::String # CORDEX, CMIP5, etc.\n  institute::String # UQAM, DMI, etc.\n  filename::String # Path of the original file\n  dataunits::String # Celsius, kelvin, etc.\n  latunits::String # latitude coordinate unit\n  lonunits::String # longitude coordinate unit\n  variable::String # Type of variable (i.e. can be the same as \"typeofvar\", but it is changed when calculating indices)\n  typeofvar::String # Variable type (e.g. tasmax, tasmin, pr)\n  typeofcal::String # Calendar type\n  timeattrib::Dict # Time attributes (e.g. days since ... )\n  varattribs::Dict # Variable attributes dictionary\n  globalattribs::Dict # Global attributes dictionary\nend","category":"page"},{"location":"datasets/#Manipulations","page":"Datasets","title":"Manipulations","text":"","category":"section"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"Once the data is loaded in a ClimGrid struct, options to further subset the data are available.","category":"page"},{"location":"datasets/#Spatial","page":"Datasets","title":"Spatial","text":"","category":"section"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"spatialsubset function acts on ClimGrid type and subset the data through a spatial subset using a provided polygon. The function returns a ClimGrid. Polygons needs to be on a -180, +180 longitude coordinates, as data coordinates defaults to such grid. For instance, global models are often on a 0-360 degrees grid but the load function shift the data onto a -180,+180 coordinates.","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"C = spatialsubset(C::ClimGrid, poly:Array{N, 2} where N)","category":"page"},{"location":"datasets/#Temporal","page":"Datasets","title":"Temporal","text":"","category":"section"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"Temporal subset of the data is also possible with the temporalsubset function:","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"C = temporalsubset(C::ClimGrid, startdate::Tuple, enddate::Tuple)","category":"page"},{"location":"datasets/#Discontinuous-temporal-(e.g.-resampling)","page":"Datasets","title":"Discontinuous temporal (e.g. resampling)","text":"","category":"section"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"It is also possible to only keep a given non-continuous period for a given timeframe. For example, we might be interested in keeping only northern summer months (June-July-August) from a continuous ClimGrid covering 1961-2100. resample returns such a subsetted ClimGrid.","category":"page"},{"location":"datasets/","page":"Datasets","title":"Datasets","text":"Csub = resample(C, \"JJA\") # hardcoded ClimateTools's season\nCsub = resample(C, 6, 8) # custom subset example for June-July-August\nCsub = resample(C, 1, 2) # custom subset example for January-February","category":"page"}]
}
